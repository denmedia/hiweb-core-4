(function(f){f.fn.pin=function(b){var g=0,h=[],q=!1,m=f(window);b=b||{};var p=function(){for(var k=0,e=h.length;k<e;k++){var a=h[k];if(b.minWidth&&m.width()<=b.minWidth)a.parent().is(".pin-wrapper")&&a.unwrap(),a.css({width:"",left:"",top:"",position:""}),b.activeClass&&a.removeClass(b.activeClass),q=!0;else{q=!1;var c=b.containerSelector?a.closest(b.containerSelector):f(document.body),d=a.offset(),l=c.offset(),n=a.offsetParent().offset();a.parent().is(".pin-wrapper")||a.wrap("<div class='pin-wrapper'>");
var g=f.extend({top:0,bottom:0},b.padding||{});a.data("pin",{pad:g,from:(b.containerSelector?l.top:d.top)-g.top,to:l.top+c.height()-a.outerHeight()-g.bottom,end:l.top+c.height(),parentTop:n.top});a.css({width:a.parent().width()});a.css({left:a.parent().offset().left});a.offset().top<a.parent().offset().top&&a.css({top:a.parent().offset().top});a.parent().css("height",a.outerHeight())}}},r=function(){if(!q){g=m.scrollTop();for(var k=[],e=0,a=h.length;e<a;e++){var c=f(h[e]),d=c.data("pin");if(d){k.push(c);
var l=d.from-d.pad.bottom,n=d.to-d.pad.top;l+c.outerHeight()>d.end?c.css("position",""):l<g&&n>g?("fixed"!=c.css("position")&&c.css({left:c.offset().left,top:d.pad.top}).css("position","fixed"),b.activeClass&&c.addClass(b.activeClass)):g>=n?(c.css({left:"",top:n-d.parentTop+d.pad.top}).css("position","absolute"),b.activeClass&&c.addClass(b.activeClass)):(c.css({position:"",top:"",left:""}),b.activeClass&&c.removeClass(b.activeClass))}}h=k}},t=function(){p();r()};this.each(function(){var b=f(this),
e=f(this).data("pin")||{};e&&e.update||(h.push(b),f("img",this).one("load",p),e.update=t,f(this).data("pin",e))});m.scroll(r);m.resize(function(){p()});p();m.load(t);return this}})(jQuery);
