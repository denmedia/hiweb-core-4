jQuery(document).ready(function(e){if(0<e("[data-image-defer-id]").length){var a={source_images_data:{},receive_images_html:{},receive_images_src:{},images_ids_queue:[],images_ids_processed:[],scroll_event_interval:200,scroll_event_handler:null,scroll_event_now:!1,queue_started:!1,init:function(){a.make_events();var d=setInterval(function(){/loaded|complete/.test(document.readyState)&&(clearInterval(d),a.receive_images_data(a.find_images_on_windows),e(document).on("ajaxComplete",function(){}))},100)},
receive_images_data:function(d){var b=e("[data-image-defer-id]");0!==b.length&&(b.each(function(){var c=e(this);a.source_images_data[c.attr("data-image-defer-id")]=JSON.parse(c.attr("data-image-defer"))}),e.ajax({url:hiweb_imageDefer_ajax_url,type:"post",dataType:"json",data:{images:a.source_images_data},success:function(c){if(c.success){for(var b in c.images)a.receive_images_html.hasOwnProperty(b)||(a.receive_images_html[b]=c.images[b],a.receive_images_src[b]=c.images_src[b]);"function"===typeof d&&
d()}e("body").append(c.js)}}))},make_events:function(){e(window).scroll(function(d){a.scroll_event_now||(a.scroll_event_now=!0,clearTimeout(a.scroll_event_handler),a.scroll_event_handler=setTimeout(function(){a.find_images_on_windows();a.queue_start();a.scroll_event_now=!1},a.scroll_event_interval))})},find_images_on_windows:function(){var d=e(window).scrollTop()+window.innerHeight,b;for(b in a.receive_images_src){var c=e('[data-image-defer-id="'+b+'"][data-image-defer-status="preload"]');0<c.length&&
c.offset().top<d+c.height()+100&&-1===a.images_ids_queue.indexOf(b)&&-1===a.images_ids_processed.indexOf(b)&&(a.images_ids_queue.push(b),a.queue_start())}},queue_start:function(){a.queue_started||(a.queue_started=!0,a.queue_next())},queue_next:function(){if(a.queue_started)if(0===a.images_ids_queue.length)a.queue_started=!1;else{var d=a.images_ids_queue.shift();a.images_ids_processed.push(d);a.load_image(d,a.queue_next)}},load_image:function(d,b){if(a.receive_images_html.hasOwnProperty(d)){var c=
e('[data-image-defer-id="'+d+'"]');if(0<c.length){c.addClass("data-image-defer-status","loading");var f=new Image;f.onload=function(){c[0].outerHTML=e(a.receive_images_html[d]).attr("data-image-defer-status","loaded")[0].outerHTML;"function"===typeof b&&b()};f.src=a.receive_images_src[d]}}}};a.init()}});
