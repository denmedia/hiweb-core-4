var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(a,c,d){a instanceof String&&(a=String(a));for(var b=a.length,e=0;e<b;e++){var f=a[e];if(c.call(d,f,e,a))return{i:e,v:f}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,c,d){a!=Array.prototype&&a!=Object.prototype&&(a[c]=d.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(a,c,d,b){if(c){d=$jscomp.global;a=a.split(".");for(b=0;b<a.length-1;b++){var e=a[b];e in d||(d[e]={});d=d[e]}a=a[a.length-1];b=d[a];c=c(b);c!=b&&null!=c&&$jscomp.defineProperty(d,a,{configurable:!0,writable:!0,value:c})}};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,d){return $jscomp.findInternal(this,a,d).v}},"es6","es3");
var hiweb_field_repeat={selector:".hiweb-field-type-repeat",selector_source:"[data-row-source]",selector_wrap:"tbody.wrap",selector_row:"[data-row]",selector_button_add:"[data-action-add]",selector_button_clear:"[data-action-clear]",selector_button_remove:"[data-action-remove]",selector_button_duplicate:"[data-action-duplicate]",init:function(a){hiweb_field_repeat.make_sortable(a);0===jQuery(a).parent().closest(hiweb_field_repeat.selector).length&&hiweb_field_repeat.set_input_names(a);jQuery(a).find("[data-action-open-flex-submenu]").each(function(){jQuery(this).qtip({content:jQuery("#"+
jQuery(this).attr("data-action-open-flex-submenu")).html(),show:{event:"click"},hide:{event:"unfocus click mouseclick"},style:{classes:"qtip-light qtip-shadow"},position:{my:"top center",at:"bottom center",adjust:{method:"shift none"}}})}).on("click",function(a){a.preventDefault()})},init_once:function(){jQuery(hiweb_field_repeat.selector).each(function(){hiweb_field_repeat.init(this)});jQuery("body").on("click",hiweb_field_repeat.selector+" "+hiweb_field_repeat.selector_button_add,hiweb_field_repeat.click_add).on("click",
".hiweb-fields-dropdown-menu "+hiweb_field_repeat.selector_button_add,hiweb_field_repeat.click_add).on("click",hiweb_field_repeat.selector+" "+hiweb_field_repeat.selector_button_remove,hiweb_field_repeat.click_remove).on("click",hiweb_field_repeat.selector+" "+hiweb_field_repeat.selector_button_duplicate,hiweb_field_repeat.click_duplicate).on("click",hiweb_field_repeat.selector+" "+hiweb_field_repeat.selector_button_clear,hiweb_field_repeat.click_clear_full)},get_row_source:function(a){return jQuery(a).find("> table > tbody[data-rows-source] > tr[data-row]")},
get_rows_list:function(a){return jQuery(a).find("> table > tbody[data-rows-list]")},get_rows:function(a){return jQuery(a).find("> table > tbody[data-rows-list] > tr[data-row]")},get_cols:function(a){return jQuery(a).find("> table > thead [data-col]")},get_cols_by_row:function(a){return jQuery(a).find("> [data-col], > td > [data-col], > td > table > tbody > tr > [data-col]")},make_sortable:function(a){var c=hiweb_field_repeat.get_rows_list(a);"undefined"==typeof c.sortable?alert("\u041f\u043b\u0430\u0433\u0438\u043d jquery.ui.sortable.js \u043d\u0435 \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d!"):
(c.sortable.hasOwnProperty("destroy")&&c.sortable("destroy"),c.sortable({update:function(c,b){hiweb_field_repeat.set_input_names(jQuery(this).closest(hiweb_field_repeat.selector));b.placeholder.find("[data-col]").each(function(){jQuery(this).trigger("hiweb-field-repeat-drag-update",[jQuery(this),jQuery(this).closest("[data-row]"),a])})},forcePlaceholderSize:!0,distance:3,handle:"> [data-drag-handle], > [data-drag-handle] button, > [data-drag-handle] i, > [data-drag-handle] svg",helper:function(c,
b){b.find("th, td").each(function(){jQuery(this).width(jQuery(this).width())});b.find("[data-col]").each(function(){jQuery(this).trigger("hiweb-field-repeat-dragged",[jQuery(this),jQuery(this).closest("[data-row]"),a])});return b},revert:!0,start:function(a,b){b.placeholder.outerHeight(b.helper.outerHeight());a=b.placeholder.closest("table");var c=b.placeholder.closest(".hiweb-field-type-repeat");a.addClass("ui-sorting-process");c.css({"perspective-origin":"50% "+c.offset().top+"px"});b.helper.find("input[name], select[name], textarea[name], file[name]").trigger("hiweb-field-repeat-drag-start")},
stop:function(a,c){c.item.closest("table").removeClass("ui-sorting-process");c.item.find("input[name], select[name], textarea[name], file[name]").trigger("hiweb-field-repeat-drag-stop")}}))},getRandomColor:function(){for(var a="#",c=0;6>c;c++)a+="0123456789ABCDEF"[Math.floor(16*Math.random())];return a},set_input_names:function(a){a=jQuery(a);a.find("[data-row]").each(function(){jQuery(this).attr("data-row",jQuery(this).index())});a.find("[name]").each(function(){jQuery(this).attr("name",hiweb_field_repeat.get_input_name(jQuery(this)))});
a.find("> table > tbody[data-rows-message] [data-row-empty]").attr("data-row-empty",0<hiweb_field_repeat.get_rows(a).length?"1":"0")},get_input_name:function(a){a=jQuery(a);for(var c=[],d=10;0<d;){var b=a.closest("[data-col]");if(1!==b.length)return a.closest(".hiweb-field-type-repeat[data-input-name]").attr("data-input-name");a=a.attr("name").split("["+b.attr("data-col")+"]");1<a.length&&(a=a.pop(),""!==a&&c.push(a));c.push("["+b.attr("data-col")+"]");b=b.closest("[data-row]");if(1!==b.length){console.warn("2: row not found");
break}c.push("["+b.attr("data-row")+"]");b=b.closest(".hiweb-field-type-repeat[data-id]");1!==b.length&&console.warn("3: repeat not found");var $super_col=b.closest("[data-col]");if(1!==$super_col.length){c.push(b.attr("data-input-name"));break}else a=b;d--}return c.reverse().join("")},get_global_id:function(a){return jQuery(a).is("[data-global-id]")?jQuery(a).attr("data-global-id"):jQuery(a).closest("[data-global-id]").attr("data-global-id")},get_name_id:function(a){return jQuery(a).is("[data-input-name]")?
jQuery(a).data("input-name"):jQuery(a).closest("[data-input-name]").data("input-name")},click_add:function(a){a.preventDefault();var c=jQuery(this);a=c.is('[data-action-add="1"]');if(c.is("[data-field-global-id]")){var d=jQuery(hiweb_field_repeat.selector+'[data-global-id="'+c.attr("data-field-global-id")+'"]');var b=c.closest(".hiweb-fields-dropdown-menu").find("[data-action-open-flex-submenu]").attr("data-action-open-flex-submenu");jQuery('[data-action-open-flex-submenu="'+b+'"]').qtip("hide");
console.info('[data-action-open-flex-submenu="'+b+'"]')}else d=jQuery(this).closest(hiweb_field_repeat.selector);c=c.is("[data-flex-id]")?c.attr("data-flex-id"):"";hiweb_field_repeat.add_rows(d,a,1,"",c)},add_rows:function(a,c,d,b,e){"undefined"===typeof d&&(d=1);"undefined"===typeof c&&(c=!1);"undefined"===typeof e&&(e="");var f=hiweb_field_repeat.get_rows_list(a);b=c?0:hiweb_field_repeat.get_rows(a).length;jQuery.ajax({url:ajaxurl+"?action=hiweb-field-repeat-get-row",type:"post",data:{id:hiweb_field_repeat.get_global_id(a),
method:"ajax_html_row",input_name:hiweb_field_repeat.get_name_id(a),index:b,flex_row_id:e},dataType:"json",success:function(b){if(b.hasOwnProperty("result")&&!0===b.result)for(b=jQuery(b.data).hide().fadeIn(),n=0;n<d;n++)c?f.prepend(b):f.append(b),b.find("[data-col]").each(function(){}),b.find("> td").wrapInner('<div style="display: none;" />').parent().find("> td > div").slideDown(400,function(){var a=jQuery(this),b=a.parent();a.replaceWith(a.contents());b.find("input[name], select[name], textarea[name], file[name]").trigger("hiweb-field-repeat-added-row-fadein")}),
hiweb_field_repeat.set_input_names(a),b.find("input[name], select[name], textarea[name], file[name]").trigger("hiweb-field-repeat-added-row");else console.warn(b)},error:function(a){console.warn(a)}})},paramsToArray:function(a,c){a=a.match(/(\[?[\d\w\-_]+\]?)/g);for(var d=temp={},b=0;b<a.length;b++){var e=a[b].replace(/^\[?([\d\w\-_]+)\]?/,"$1");temp=b===a.length-1?temp[e]=c:temp[e]={}}return d},click_duplicate:function(a){a.preventDefault();var c=jQuery(this).closest(hiweb_field_repeat.selector);
hiweb_field_repeat.get_rows_list(c);var d=jQuery(this).closest(hiweb_field_repeat.selector_row),b=[],e=hiweb_field_repeat.get_input_name(this)+"["+d.attr("data-row")+"]";d.find("input[name], select[name], textarea[name], file[name]").each(function(){var a=jQuery(this).attr("name");0===a.indexOf(e)&&(a=a.substr(e.toString().length).replace(/^\[([\w\d\-_]+)\]/g,"$1"),b.push(hiweb_field_repeat.paramsToArray(a,jQuery(this).val())))});jQuery.ajax({url:ajaxurl+"?action=hiweb-field-repeat-get-row",type:"post",
data:{id:hiweb_field_repeat.get_global_id(this),method:"ajax_html_row",row_index:d.attr("data-row"),values:deepMerge.all(b)},dataType:"json",success:function(a){if(a.hasOwnProperty("result")&&!0===a.result){var b=jQuery(a.data).hide().fadeIn();d.after(b);b.find("[data-col]").each(function(){jQuery(this).trigger("hiweb-field-repeat-add-new-row",[jQuery(this),b,c])});b.css("opacity",0).animate({opacity:1}).find("> td").wrapInner('<div style="display: none;" />').parent().find("> td > div").slideDown(700,
function(){var a=jQuery(this);a.replaceWith(a.contents())});hiweb_field_repeat.set_input_names(c)}else console.warn(a)},error:function(a){console.warn(a)}})},click_remove:function(a){a.preventDefault();a=jQuery(this).closest(hiweb_field_repeat.selector_row);hiweb_field_repeat.do_remove_row(a)},do_remove_row:function(a){return jQuery(a).find("> td").wrapInner('<div style="display: block;" />').parent().find("> td > div").slideUp(700,function(){var c=a.closest(hiweb_field_repeat.selector);jQuery(this).parent().parent().remove();
a.remove();hiweb_field_repeat.set_input_names(c);0===hiweb_field_repeat.get_rows(c).length&&jQuery(c).find(".message").fadeIn()})},click_clear_full:function(a){a.preventDefault();confirm("Remove all table rows?")&&(a=jQuery(this).closest(hiweb_field_repeat.selector),hiweb_field_repeat.get_rows(a).each(function(){hiweb_field_repeat.do_remove_row(this)}))}};jQuery(document).ready(hiweb_field_repeat.init_once);jQuery("body").on("hiweb-field-repeat-added-new-row","[data-col]",function(a,c,d,b){c.find(".hiweb-field-type-repeat").each(function(){hiweb_field_repeat.init(this)})});
