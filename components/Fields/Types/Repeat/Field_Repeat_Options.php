<?php
	
	namespace hiweb\components\Fields\Types\Repeat;
	
	
	use hiweb\components\Fields\Field;
	use hiweb\components\Fields\Field_Options;
	
	
	class Field_Repeat_Options extends Field_Options{
		
		
		/**
		 * @return Field_Repeat
		 */
		public function Field(){
			return parent::Field(); // TODO: Change the autogenerated stub
		}
		
		
		/**
		 * @return array|Field_Repeat_Options|Field_Repeat_Col[][]
		 */
		public function get_cols(){
			$cols = $this->_( 'cols' );
			if( !is_array( $cols ) ){
				$cols = [];
				$this->_( 'cols', [] );
			}
			return $this->_( 'cols' );
		}
		
		
		/**
		 * @return array
		 */
		public function get_flex_ids(){
			return array_keys( $this->get_cols() );
		}
		
		
		/**
		 * @return array
		 */
		public function get_cols_simple( $prefix_name = '' ){
			$R = [];
			foreach( $this->get_cols() as $group => $cols ){
				if( !is_array( $cols ) ) continue;
				foreach( $cols as $global_id => $col ){
					$R[ $group ][ $global_id ] = $col->_get_optionsCollect();
					$new_name = '\'' . $prefix_name . '[\' + index + \'][' . $col->Field()->ID() . ']\'';
					$R[ $group ][ $global_id ]['admin_html'] = preg_replace( '/(\sname=)(\'|")/im', ' :name=$2', $col->Field()->get_admin_html( null, $new_name ) );
				}
			}
			return $R;
		}
		
		
		/**
		 * @return bool
		 */
		public function have_cols(){
			return count( $this->get_cols() ) > 0;
		}
		
		
		/**
		 * @param                     $flex_id
		 * @param Field|Field_Options $Field_or_FieldOptions
		 * @return Field_Repeat_Col
		 */
		public function add_col_flex_field( $flex_id, $Field_or_FieldOptions ){
			$cols = $this->get_cols();
			$col = new Field_Repeat_Col( $this->Field(), $Field_or_FieldOptions );
			$Flex = $this->Field()->get_flex( $flex_id );
			$cols[ $Flex->ID() ][ $col->Field()->ID() ] = $col;
			$this->_( 'cols', $cols );
			return $col;
		}
		
		
		/**
		 * @param Field|Field_Options $Field_or_FieldOptions
		 * @param string              $flex_id
		 * @return Field_Repeat_Col
		 */
		public function add_col_field( $Field_or_FieldOptions, $flex_id = '' ){
			return $this->add_col_flex_field( $flex_id, $Field_or_FieldOptions );
		}
		
	}