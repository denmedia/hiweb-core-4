var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(d,c,a){d instanceof String&&(d=String(d));for(var b=d.length,e=0;e<b;e++){var h=d[e];if(c.call(a,h,e,d))return{i:e,v:h}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(d,c,a){d!=Array.prototype&&d!=Object.prototype&&(d[c]=a.value)};
$jscomp.getGlobal=function(d){return"undefined"!=typeof window&&window===d?d:"undefined"!=typeof global&&null!=global?global:d};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(d,c,a,b){if(c){a=$jscomp.global;d=d.split(".");for(b=0;b<d.length-1;b++){var e=d[b];e in a||(a[e]={});a=a[e]}d=d[d.length-1];b=a[d];c=c(b);c!=b&&null!=c&&$jscomp.defineProperty(a,d,{configurable:!0,writable:!0,value:c})}};
$jscomp.polyfill("Array.prototype.find",function(d){return d?d:function(c,a){return $jscomp.findInternal(this,c,a).v}},"es6","es3");
jQuery(document).ready(function(d){var c={selector:".hiweb-field_repeat",qtips:{},sortables:{},lastRowIndex:{},init:function(){var a=d(this);a.is("[data-unique_id]")&&(c.init_buttons(a),c.make_sortable(a),c.set_input_names(a))},last_row_index:function(a,b){a=a.is("[data-unique_id]")?a.attr("data-unique_id"):a.closest(c.selector).attr("data-unique_id");if(void 0===b)return c.lastRowIndex.hasOwnProperty(a)?c.lastRowIndex[a]:0;c.lastRowIndex[a]=b},open_dropdown:function(a){var b=a.attr("data-unique_id");
a.is("[data-index]")&&c.last_row_index(a,a.attr("data-index"));if(!c.qtips.hasOwnProperty(b)){var e=d('[data-dropdown-content="'+b+'"]');c.qtips[b]=e.qtip({content:e,show:{target:a,event:"click",effect:function(){jQuery(this).fadeIn(300)}},hide:{event:"unfocus focusout mouseleave click mouseclick",delay:100,effect:function(){jQuery(this).fadeOut(400)}},style:{classes:"qtip-light qtip-shadow qtip-hiweb-fields"},position:{my:"top center",at:"bottom center",viewport:!0,adjust:{method:"shift flip"}}});
e.on("click","a",function(){c.qtips[b].qtip("hide")})}c.qtips[b].qtip("show").qtip("option","position.target",a)},open_row_control:function(a){var b=a.attr("data-unique_id"),e=b+"-row_control";c.last_row_index(a,a.closest("[data-row]").attr("data-row"));c.qtips.hasOwnProperty(e)||(b=d('[data-row-control="'+b+'"]'),c.qtips[e]=b.qtip({content:b,show:{target:a,event:"click",effect:function(){jQuery(this).fadeIn(300)}},hide:{event:"unfocus focusout mouseleave click mouseclick",delay:200,effect:function(){jQuery(this).fadeOut(400)}},
style:{classes:"qtip-light qtip-shadow qtip-hiweb-fields"},position:{my:"top right",at:"bottom center",viewport:!0,adjust:{method:"shift flip"}}}),b.on("click","a",function(){c.qtips[e].qtip("hide")}));c.qtips[e].qtip("show").qtip("option","position.target",a)},init_buttons:function(a){if(a=a.attr("data-unique_id"))d("body").on("click",'[data-action][data-unique_id="'+a+'"]',function(a){var b=d(this);switch(b.attr("data-action")){case "dropdown":c.open_dropdown(b);break;case "row-control":c.open_row_control(b);
break;case "add":c.click_add(b);break;case "remove":c.click_remove(b);break;case "clear":c.click_clear_full(b);break;case "duplicate":c.click_duplicate(b);break;case "copy":c.click_copy(b);break;case "paste":c.click_paste(b);break;case "collapse":c.click_row_expand(b);break;case "options":c.click_options(b)}a.preventDefault()})},set_input_names:function(a,b){var e=a.attr("data-unique_id");void 0===b&&(b=[a.attr("data-field-input_name")]);var h=a.find('[data-rows_list="'+e+'"] > [data-row]');a.attr("data-rows-count",
h.length);a=d('.repeat__message_empty[data-unique_id="'+e+'"]');0===h.length?a.height(a.find(".repeat__message_empty_inner").outerHeight()):a.height(0);h.each(function(){var a=d(this);a.attr("data-row",a.index());var g=b.slice();g.push("["+a.index()+"]");a.find("[data-field-input_name]").not(c.selector+'[data-unique_id="'+e+'"] '+c.selector+" [data-field-input_name]").each(function(){var a=d(this),b=g.slice();b.push("["+a.attr("data-field-id")+"]");var e=b.join("");a.attr("data-field-input_name",
e);a.is(c.selector)?c.set_input_names(a):(b=a.find(":input[data-input_name_source]"),0===b.length&&(b=a.find(":input[name]")),b.each(function(){var a=d(this);a.attr("name",a.is("[data-input_name_append]")?e+a.attr("data-input_name_append"):e)}),a.trigger("field_name_change"))})})},click_copy:function(a){var b=d(c.selector+'[data-unique_id="'+a.attr("data-unique_id")+'"]'),e={};e="-1"===c.last_row_index(b)||"+1"===c.last_row_index(b)?b.find("[name]:input").serializeArray():d('[data-row="'+c.last_row_index(b)+
'"][data-unique_id='+a.attr("data-unique_id")+"]").find("[name]:input").serializeArray();a=b.attr("data-unique_id");var h={},k=b.attr("data-field-input_name"),g={},l;for(l in e){var f=e[l].name;0<=f.indexOf(k)&&(f=f.substr(k.length).replace(/^\[(\d+)\]/,"$1"),f.match(/\[\]$/)&&(g.hasOwnProperty(f)||(g[f]=-1),g[f]++,f=f.replace(/\[\]$/,"["+g[f]+"]")),h[f]=e[l].value)}h=c.parseInputs(h);d.ajax({url:ajaxurl+"?action=hiweb-field-repeat-get-row",type:"post",dataType:"json",data:{id:b.attr("data-field-global_id"),
method:"copy",input_name:b.attr("data-field-input_name"),value:h,unique_id:a},success:function(a){a.hasOwnProperty("success")&&a.success&&d('.hiweb-field_repeat__row-control [data-action="copy"]').removeClass("disabled")}})},click_paste:function(a){a=d(c.selector+'[data-unique_id="'+a.attr("data-unique_id")+'"]');c.add_rows(a,"::paste::",c.last_row_index(a))},make_sortable:function(a){var b=a.attr("data-unique_id"),e=d('[data-rows_list="'+b+'"]');if("undefined"==typeof e.sortable)alert("\u041f\u043b\u0430\u0433\u0438\u043d jquery.ui.sortable.js \u043d\u0435 \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d!");
else{c.sortables.hasOwnProperty(b)&&c.sortables[b].sortable("destroy");var h=d('[data-rows_list][data-field-global_id="'+e.attr("data-field-global_id")+'"]');c.sortables[b]=e.sortable({update:function(e,g){d('[data-drag-handle="'+b+'"]').each(function(){d(this).attr("data-drag-handle",d(this).closest(c.selector).attr("data-unique_id"))});c.set_input_names(a)},tolerance:"intersect",forcePlaceholderSize:!0,distance:3,handle:'[data-drag-handle="'+b+'"], [data-drag-handle="'+b+'"] *',connectWith:h,revert:!0,
start:function(a,b){b.placeholder.outerHeight(b.helper.outerHeight());a=d('[data-rows_list][data-field-global_id="'+e.attr("data-field-global_id")+'"]');e.sortable("option","connectWith",a);a.each(function(){var a=d(this).closest(c.selector).find("[data-rows_list]");0===a.find("> *").length&&a.append('<div class="ui-sortable-placeholder" style="height: 50px;"></div>')})},stop:function(a,b){h.each(function(){h.closest(c.selector).find("[data-rows_list] > .ui-sortable-placeholder").remove()})}})}},
click_add:function(a){var b=a.attr("data-unique_id");a=a.is("[data-flex_id]")?a.attr("data-flex_id"):"";b=jQuery(c.selector+'[data-unique_id="'+b+'"]');c.add_rows(b,a,c.last_row_index(b),"")},get_name_id:function(a){return jQuery(a).is("[data-input_name]")?jQuery(a).attr("data-input_name"):jQuery(a).closest("[data-input_name]").attr("data-input_name")},add_rows:function(a,b,e,h){if(a.is(c.selector)){var k=a.attr("data-unique_id"),g=a.find('[data-rows_list="'+k+'"]');void 0===b&&(b="");a.attr("data-status",
"loading");d.ajax({url:ajaxurl+"?action=hiweb-field-repeat-get-row",type:"post",dataType:"json",data:{id:a.attr("data-field-global_id"),method:"ajax_json_row",input_name:a.attr("data-field-input_name"),index:e,value:b,unique_id:k},success:function(b){if(b.hasOwnProperty("success"))if(b.success){var f=d(b.html);f.addClass("row_add collapsed");if("-1"===e)g.prepend(f);else if("+1"===e)g.append(f);else{var k=g.find('> [data-row="'+e+'"]');f.insertAfter(k)}c.set_input_names(a);g.find('[data-field-init="0"]').trigger("field_init").attr("data-field-init",
"1");"function"===typeof g.sortable&&g.sortable("option","connectWith",d('[data-rows_list][data-field-global_id="'+g.attr("data-field-global_id")+'"]'));f.height(f.find("> .repeat__row_inner").outerHeight()+"px").removeClass("row_add");setTimeout(function(){f.height("");f.removeClass("collapsed")},500);"function"===typeof h&&h(b)}else alert(b.message);else alert("Fatal error...")},complete:function(){a.attr("data-status","loaded")}})}},parseInputs:function(a){var b={},c;a:for(c in a){var d=a[c],k=
c.split("["),g=b,l;for(l in k){var f=k[l];"]"==f.substr(-1)&&(f=f.substr(0,f.length-1));if(l==k.length-1){g[f]=d;continue a}else g.hasOwnProperty(f)||(g[f]={});g=g[f]}}return b},click_duplicate:function(a){var b=d('[data-row="'+c.last_row_index(a)+'"][data-unique_id='+a.attr("data-unique_id")+"]");a=d(c.selector+'[data-unique_id="'+a.attr("data-unique_id")+'"]');var e={},h=b.find("[name]:input").serializeArray(),k=a.attr("data-field-input_name"),g={},l;for(l in h){var f=h[l].name;0<=f.indexOf(k)&&
(f=f.substr(k.length).replace(/^\[(\d+)\]/,"$1"),f.match(/\[\]$/)&&(g.hasOwnProperty(f)||(g[f]=-1),g[f]++,f=f.replace(/\[\]$/,"["+g[f]+"]")),e[f]=h[l].value)}c.add_rows(a,c.parseInputs(e),b.attr("data-row"))},click_remove:function(a){c.do_remove_row(d(c.selector+'[data-unique_id="'+a.attr("data-unique_id")+'"]'),c.last_row_index(a))},do_remove_row:function(a,b){var d=a.find('[data-unique_id="'+a.attr("data-unique_id")+'"][data-row="'+b+'"]');setTimeout(function(){d.remove();c.set_input_names(a)},
500);d.addClass("row_remove").height(d.find("> *").outerHeight()).height(0)},click_clear_full:function(a){a=a.attr("data-unique_id");var b=jQuery(c.selector+'[data-unique_id="'+a+'"]');0!==b.length&&confirm(b.attr("data-text_confirm_clear_all"))&&d('[data-row][data-unique_id="'+a+'"]').each(function(){c.do_remove_row(b,d(this).attr("data-row"))})},click_options:function(a){var b=a.attr("data-unique_id");a=d('[data-row="'+a.closest("[data-row]").attr("data-row")+'"][data-unique_id="'+b+'"]').find(".repeat__row__options_fields__outer").attr("id");
"function"===typeof tb_show&&d('a[data-tb-inline-id="'+a+'"]').trigger("click")},click_row_expand:function(a){a=a.attr("data-unique_id");var b=jQuery('[data-row="'+c.lastRowIndex[a]+'"][data-unique_id="'+a+'"]');0<b.closest(".ui-sorting-process").length||(b.is(".repeat__row__collapsed")?(b.removeClass("repeat__row__collapsed"),jQuery('[data-flex-row-collapsed-input="'+a+'"]').val("0")):(b.height(b.find(jQuery("> .repeat__row_inner > .repeat__row__fields").height())),b.addClass("repeat__row__collapsed"),
b.height("auto"),jQuery('[data-flex-row-collapsed-input="'+a+'"]').val("1")))},click_row_expand_all:function(a){a.preventDefault();a=jQuery(this).attr("data-unique_id");var b=jQuery(c.selector+'[data-unique_id="'+a+'"] [data-row]');b.length!==b.filter(".row-collapsed").length?(b.addClass("row-collapsed"),jQuery('[data-flex-row-collapsed-input="'+a+'"]').val("1")):(b.removeClass("row-collapsed"),jQuery('[data-flex-row-collapsed-input="'+a+'"]').val("0"))}};d("body").on("field_init",'.hiweb-field_repeat[data-field-init="0"]',
c.init)});
