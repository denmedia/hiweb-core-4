var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(e,b,a){e instanceof String&&(e=String(e));for(var c=e.length,d=0;d<c;d++){var h=e[d];if(b.call(a,h,d,e))return{i:d,v:h}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(e,b,a){if(e==Array.prototype||e==Object.prototype)return e;e[b]=a.value;return e};$jscomp.getGlobal=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<e.length;++b){var a=e[b];if(a&&a.Math==Math)return a}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(e,b){var a=$jscomp.propertyToPolyfillSymbol[b];if(null==a)return e[b];a=e[a];return void 0!==a?a:e[b]};
$jscomp.polyfill=function(e,b,a,c){b&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(e,b,a,c):$jscomp.polyfillUnisolated(e,b,a,c))};$jscomp.polyfillUnisolated=function(e,b,a,c){a=$jscomp.global;e=e.split(".");for(c=0;c<e.length-1;c++){var d=e[c];if(!(d in a))return;a=a[d]}e=e[e.length-1];c=a[e];b=b(c);b!=c&&null!=b&&$jscomp.defineProperty(a,e,{configurable:!0,writable:!0,value:b})};
$jscomp.polyfillIsolated=function(e,b,a,c){var d=e.split(".");e=1===d.length;c=d[0];c=!e&&c in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var h=0;h<d.length-1;h++){var l=d[h];if(!(l in c))return;c=c[l]}d=d[d.length-1];a=$jscomp.IS_SYMBOL_NATIVE&&"es6"===a?c[d]:null;b=b(a);null!=b&&(e?$jscomp.defineProperty($jscomp.polyfills,d,{configurable:!0,writable:!0,value:b}):b!==a&&($jscomp.propertyToPolyfillSymbol[d]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(d):$jscomp.POLYFILL_PREFIX+d,d=
$jscomp.propertyToPolyfillSymbol[d],$jscomp.defineProperty(c,d,{configurable:!0,writable:!0,value:b})))};$jscomp.polyfill("Array.prototype.find",function(e){return e?e:function(b,a){return $jscomp.findInternal(this,b,a).v}},"es6","es3");
jQuery(document).ready(function(e){var b={selector:".hiweb-field_repeat",qtips:{},sortables:{},lastRowIndex:{},init:function(){var a=e(this);a.is("[data-unique_id]")&&(b.init_buttons(a),b.make_sortable(a),b.set_input_names(a))},last_row_index:function(a,c){a=a.is("[data-unique_id]")?a.attr("data-unique_id"):a.closest(b.selector).attr("data-unique_id");if(void 0===c)return b.lastRowIndex.hasOwnProperty(a)?b.lastRowIndex[a]:0;b.lastRowIndex[a]=c},open_dropdown:function(a){var c=a.attr("data-unique_id");
a.is("[data-index]")&&b.last_row_index(a,a.attr("data-index"));if(!b.qtips.hasOwnProperty(c)){var d=e('[data-dropdown-content="'+c+'"]');b.qtips[c]=d.qtip({content:d,show:{target:a,event:"click",effect:function(){jQuery(this).fadeIn(300)}},hide:{event:"unfocus focusout mouseleave click mouseclick",delay:100,effect:function(){jQuery(this).fadeOut(400)}},style:{classes:"qtip-light qtip-shadow qtip-hiweb-fields"},position:{my:"top center",at:"bottom center",viewport:!0,adjust:{method:"shift flip"}}});
d.on("click","a",function(){b.qtips[c].qtip("hide")})}b.qtips[c].qtip("show").qtip("option","position.target",a)},open_row_control:function(a){var c=a.attr("data-unique_id"),d=c+"-row_control";b.last_row_index(a,a.closest("[data-row]").attr("data-row"));b.qtips.hasOwnProperty(d)||(c=e('[data-row-control="'+c+'"]'),b.qtips[d]=c.qtip({content:c,show:{target:a,event:"click",effect:function(){jQuery(this).fadeIn(300)}},hide:{event:"unfocus focusout mouseleave click mouseclick",delay:200,effect:function(){jQuery(this).fadeOut(400)}},
style:{classes:"qtip-light qtip-shadow qtip-hiweb-fields"},position:{my:"top right",at:"bottom center",viewport:!0,adjust:{method:"shift flip"}}}),c.on("click","a",function(){b.qtips[d].qtip("hide")}));b.qtips[d].qtip("show").qtip("option","position.target",a)},init_buttons:function(a){if(a=a.attr("data-unique_id"))e("body").on("click",'[data-action][data-unique_id="'+a+'"]',function(c){var d=e(this);switch(d.attr("data-action")){case "dropdown":b.open_dropdown(d);break;case "row-control":b.open_row_control(d);
break;case "add":b.click_add(d);break;case "remove":b.click_remove(d);break;case "clear":b.click_clear_full(d);break;case "duplicate":b.click_duplicate(d);break;case "copy":b.click_copy(d);break;case "paste":b.click_paste(d);break;case "collapse":b.click_row_expand(d);break;case "expand_all":case "collapse_all":b.click_row_expand_all(d);break;case "options":b.click_options(d)}c.preventDefault()})},set_input_names:function(a,c){var d=a.attr("data-unique_id");void 0===c&&(c=[a.attr("data-field-input_name")]);
var h=a.find('[data-rows_list="'+d+'"] > [data-row]');a.attr("data-rows-count",h.length);a=e('.repeat__message_empty[data-unique_id="'+d+'"]');0===h.length?a.height(a.find(".repeat__message_empty_inner").outerHeight()):a.height(0);h.each(function(){var l=e(this);l.attr("data-row",l.index());var g=c.slice();g.push("["+l.index()+"]");l.find("[data-field-input_name]").not(b.selector+'[data-unique_id="'+d+'"] '+b.selector+" [data-field-input_name]").each(function(){var k=e(this),f=g.slice();f.push("["+
k.attr("data-field-id")+"]");var m=f.join("");k.attr("data-field-input_name",m);k.is(b.selector)?b.set_input_names(k):(f=k.find(":input[data-input_name_source]"),0===f.length&&(f=k.find(":input[name]")),f.each(function(){var n=e(this);n.attr("name",n.is("[data-input_name_append]")?m+n.attr("data-input_name_append"):m)}),k.trigger("field_name_change"))})})},click_copy:function(a){var c=e(b.selector+'[data-unique_id="'+a.attr("data-unique_id")+'"]'),d={};d="-1"===b.last_row_index(c)||"+1"===b.last_row_index(c)?
c.find("[name]:input").serializeArray():e('[data-row="'+b.last_row_index(c)+'"][data-unique_id='+a.attr("data-unique_id")+"]").find("[name]:input").serializeArray();a=c.attr("data-unique_id");var h={},l=c.attr("data-field-input_name"),g={},k;for(k in d){var f=d[k].name;0<=f.indexOf(l)&&(f=f.substr(l.length).replace(/^\[(\d+)\]/,"$1"),f.match(/\[\]$/)&&(g.hasOwnProperty(f)||(g[f]=-1),g[f]++,f=f.replace(/\[\]$/,"["+g[f]+"]")),h[f]=d[k].value)}h=b.parseInputs(h);e.ajax({url:ajaxurl+"?action=hiweb-field-repeat-get-row",
type:"post",dataType:"json",data:{id:c.attr("data-field-global_id"),method:"copy",input_name:c.attr("data-field-input_name"),value:h,unique_id:a},success:function(m){m.hasOwnProperty("success")&&m.success&&e('.hiweb-field_repeat__row-control [data-action="copy"]').removeClass("disabled")}})},click_paste:function(a){a=e(b.selector+'[data-unique_id="'+a.attr("data-unique_id")+'"]');b.add_rows(a,"::paste::",b.last_row_index(a))},make_sortable:function(a){var c=a.attr("data-unique_id"),d=e('[data-rows_list="'+
c+'"]');if("undefined"==typeof d.sortable)alert("\u041f\u043b\u0430\u0433\u0438\u043d jquery.ui.sortable.js \u043d\u0435 \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d!");else{b.sortables.hasOwnProperty(c)&&b.sortables[c].sortable("destroy");var h=e('[data-rows_list][data-field-global_id="'+d.attr("data-field-global_id")+'"]');b.sortables[c]=d.sortable({update:function(l,g){e('[data-drag-handle="'+c+'"]').each(function(){e(this).attr("data-drag-handle",e(this).closest(b.selector).attr("data-unique_id"))});
b.set_input_names(a)},tolerance:"intersect",forcePlaceholderSize:!0,distance:3,handle:'[data-drag-handle="'+c+'"], [data-drag-handle="'+c+'"] *',connectWith:h,revert:!0,start:function(l,g){g.placeholder.outerHeight(g.helper.outerHeight());l=e('[data-rows_list][data-field-global_id="'+d.attr("data-field-global_id")+'"]');d.sortable("option","connectWith",l);l.each(function(){var k=e(this).closest(b.selector).find("[data-rows_list]");0===k.find("> *").length&&k.append('<div class="ui-sortable-placeholder" style="height: 50px;"></div>')})},
stop:function(l,g){h.each(function(){h.closest(b.selector).find("[data-rows_list] > .ui-sortable-placeholder").remove()})}})}},click_add:function(a){var c=a.attr("data-unique_id");a=a.is("[data-flex_id]")?a.attr("data-flex_id"):"";c=jQuery(b.selector+'[data-unique_id="'+c+'"]');b.add_rows(c,a,b.last_row_index(c),"")},get_name_id:function(a){return jQuery(a).is("[data-input_name]")?jQuery(a).attr("data-input_name"):jQuery(a).closest("[data-input_name]").attr("data-input_name")},add_rows:function(a,
c,d,h){if(a.is(b.selector)){var l=a.attr("data-unique_id"),g=a.find('[data-rows_list="'+l+'"]');void 0===c&&(c="");a.attr("data-status","loading");e.ajax({url:ajaxurl+"?action=hiweb-field-repeat-get-row",type:"post",dataType:"json",data:{id:a.attr("data-field-global_id"),method:"ajax_json_row",input_name:a.attr("data-field-input_name"),index:d,value:c,unique_id:l},success:function(k){if(k.hasOwnProperty("success"))if(k.success){var f=e(k.html);f.addClass("row_add collapsed");if("-1"===d)g.prepend(f);
else if("+1"===d)g.append(f);else{var m=g.find('> [data-row="'+d+'"]');f.insertAfter(m)}b.set_input_names(a);g.find('[data-field-init="0"]').trigger("field_init").attr("data-field-init","1");"function"===typeof g.sortable&&g.sortable("option","connectWith",e('[data-rows_list][data-field-global_id="'+g.attr("data-field-global_id")+'"]'));f.height(f.find("> .repeat__row_inner").outerHeight()+"px").removeClass("row_add");setTimeout(function(){f.height("");f.removeClass("collapsed")},500);"function"===
typeof h&&h(k)}else alert(k.message);else alert("Fatal error...")},complete:function(){a.attr("data-status","loaded")}})}},parseInputs:function(a){var c={},d;a:for(d in a){var h=a[d],l=d.split("["),g=c,k;for(k in l){var f=l[k];"]"==f.substr(-1)&&(f=f.substr(0,f.length-1));if(k==l.length-1){g[f]=h;continue a}else g.hasOwnProperty(f)||(g[f]={});g=g[f]}}return c},click_duplicate:function(a){var c=e('[data-row="'+b.last_row_index(a)+'"][data-unique_id='+a.attr("data-unique_id")+"]");a=e(b.selector+'[data-unique_id="'+
a.attr("data-unique_id")+'"]');var d={},h=c.find("[name]:input").serializeArray(),l=a.attr("data-field-input_name"),g={},k;for(k in h){var f=h[k].name;0<=f.indexOf(l)&&(f=f.substr(l.length).replace(/^\[(\d+)\]/,"$1"),f.match(/\[\]$/)&&(g.hasOwnProperty(f)||(g[f]=-1),g[f]++,f=f.replace(/\[\]$/,"["+g[f]+"]")),d[f]=h[k].value)}b.add_rows(a,b.parseInputs(d),c.attr("data-row"))},click_remove:function(a){b.do_remove_row(e(b.selector+'[data-unique_id="'+a.attr("data-unique_id")+'"]'),b.last_row_index(a))},
do_remove_row:function(a,c){var d=a.find('[data-unique_id="'+a.attr("data-unique_id")+'"][data-row="'+c+'"]');setTimeout(function(){d.remove();b.set_input_names(a)},500);d.addClass("row_remove").height(d.find("> *").outerHeight()).height(0)},click_clear_full:function(a){a=a.attr("data-unique_id");var c=jQuery(b.selector+'[data-unique_id="'+a+'"]');0!==c.length&&confirm(c.attr("data-text_confirm_clear_all"))&&e('[data-row][data-unique_id="'+a+'"]').each(function(){b.do_remove_row(c,e(this).attr("data-row"))})},
click_options:function(a){a=a.attr("data-tb-inline-id");"function"===typeof tb_show&&e('a.thickbox[data-tb-inline-id="'+a+'"]').trigger("click")},click_row_expand:function(a){var c=a.attr("data-unique_id");a=a.closest('[data-row][data-unique_id="'+c+'"]');a=0<a.length?a:jQuery('[data-row="'+b.lastRowIndex[c]+'"][data-unique_id="'+c+'"]');var d=a.find('.repeat__row__fields[data-unique_id="'+c+'"]');0<a.closest(".ui-sorting-process").length||(a.is(".repeat__row__collapsed")?(a.removeClass("repeat__row__collapsed"),
jQuery('[data-flex-row-collapsed-input="'+c+'"]').val("0")):(d.css({"max-height":d.height()}),a.addClass("repeat__row__collapsed"),d.css({"max-height":""}),jQuery('[data-flex-row-collapsed-input="'+c+'"]').val("1")))},click_row_expand_all:function(a){a=jQuery(a).attr("data-unique_id");var c=jQuery(b.selector+' [data-row][data-unique_id="'+a+'"]'),d=c.find('.repeat__row__fields[data-unique_id="'+a+'"]');c.length!==c.filter(".repeat__row__collapsed").length?(d.each(function(){e(this).css({"max-height":e(this).height()})}),
c.addClass("repeat__row__collapsed"),jQuery('[data-flex-row-collapsed-input="'+a+'"]').val("1"),d.each(function(){e(this).css({"max-height":""})})):(c.removeClass("repeat__row__collapsed"),jQuery('[data-flex-row-collapsed-input="'+a+'"]').val("0"))}};e("body").on("field_init",'.hiweb-field_repeat[data-field-init="0"]',b.init)});
